#ifndef _VSDR2HDR_H_
#define _VSDR2HDR_H_
#include <stdint.h>
#include <sys/types.h>
#include <utils/Errors.h>
#include <utils/Log.h>
#include <fstream>
#include <cutils/properties.h>
#include <unistd.h>
#include <pthread.h>
#include <utils/StrongPointer.h>
#include <utils/RefBase.h>
#include "SensorCtrlIntf.h"
#include "DisplayFeatureHal.h"
#include "parseXml.h"
#include "DisplayPostprocessing.h"
#include "display_effects.h"

#define IGC_TABLE_LEN 257
#define TOTAL_SRE_IGC 43
#define TOTAL_VSDR2HDR_IGC 4
namespace android {
class DisplayEffectBase;

/* display VSDR2HDR function*/
class DisplayVSDR2HDR : public RefBase
{
public:
    DisplayVSDR2HDR(const sp<DisplayEffectBase>& display_effect);
    virtual ~DisplayVSDR2HDR() { };
    int setVSDR2HDRFunction(int mode, int  cookie);
    void setDisplayState(int display_state);
    int getVSDR2HDRStatus();
    int histogram_operation(int cmd);
    static void *ThreadWrapperVSDR2HDRHist(void *);
    int threadFuncVSDR2HDRHist();
    static void *ThreadWrapperVSDR2HDRIGC(void *);
    int threadFuncVSDR2HDRIGC();

private:
    sp<DisplayEffectBase> mDisplayEffect;
    pthread_t mThreadVsdr2hdrHist;
    pthread_cond_t mVsdr2hdrHistCond;
    pthread_mutex_t mVsdr2hdrHistlock;
    int mThreadHistExit;
    int mHistStatus = HIST_CMD_STOP;
    Mutex mVsdr2hdrHistLock;
    int mContrastHistInfo = 3;
    int mDisplayState;
    int mVsdr2hdrEnabled = 0;
    pthread_t mThreadVsdr2hdrIGC;
    pthread_cond_t mVsdr2hdrCPIGCCond;
    pthread_mutex_t mVsdr2hdrIGClock;
    Mutex mVsdr2hdrIgcLock;
    int huesatcircle = 0;
     int mVsdr2hdrIgcGamma[TOTAL_VSDR2HDR_IGC][IGC_TABLE_LEN] = {
        /* level 0 */
        {0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,4,5,5,6,7,8,9,10,11,13,14,15,17,18,20,22,23,25,27,
        29,32,34,36,39,41,44,47,49,52,55,58,62,65,68,72,76,79,83,87,91,96,100,104,109,
        113,118,123,128,133,138,144,149,155,161,166,172,179,185,191,198,204,211,218,
        225,232,239,247,254,262,270,278,286,294,302,311,319,328,337,346,355,364,374,
        384,393,403,413,423,434,444,455,466,477,488,499,510,522,534,546,560,574,589,
        604,619,634,649,665,681,697,713,729,746,763,780,797,815,832,850,868,887,905,
        924,943,962,981,1001,1021,1041,1061,1079,1098,1117,1137,1156,1176,1195,1215,
        1235,1256,1276,1297,1318,1339,1360,1381,1403,1425,1447,1469,1491,1513,1536,
        1559,1582,1605,1629,1652,1676,1700,1724,1749,1773,1798,1823,1848,1873,1898,
        1924,1950,1974,1997,2021,2045,2070,2094,2119,2143,2168,2193,2219,2244,2270,
        2295,2321,2347,2373,2400,2426,2453,2479,2506,2534,2561,2588,2616,2644,2671,
        2700,2728,2756,2785,2813,2842,2871,2900,2930,2959,2989,3019,3049,3079,3109,
        3140,3170,3201,3232,3263,3295,3326,3358,3390,3421,3454,3486,3518,3551,3584,
        3617,3650,3683,3716,3750,3784,3818,3852,3886,3920,3955,3990,4025,4060,4095,4095},
        /* level 1 */
        {0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,3,3,4,5,6,7,8,9,10,12,14,16,17,20,22,24,27,29,31,34,
        37,39,42,45,49,52,55,59,63,67,71,75,79,84,89,94,99,104,109,115,121,127,132,139,
        145,151,158,165,172,179,186,194,201,209,217,225,233,241,250,258,267,276,285,
        294,303,312,322,331,341,351,361,371,381,392,402,413,424,435,446,457,468,479,
        492,505,518,531,544,557,571,584,598,612,627,641,656,671,687,703,720,736,753,
        771,788,806,824,842,860,879,898,917,936,956,976,996,1017,1037,1058,1079,1100,
        1121,1143,1164,1185,1207,1229,1251,1272,1293,1315,1337,1359,1381,1403,1425,
        1448,1470,1493,1516,1540,1563,1587,1611,1635,1660,1684,1709,1734,1760,1785,
        1811,1836,1863,1889,1915,1941,1968,1995,2022,2050,2077,2105,2133,2160,2189,
        2217,2245,2273,2300,2327,2355,2383,2411,2438,2465,2492,2519,2546,2573,2600,
        2627,2654,2681,2708,2735,2762,2789,2816,2843,2870,2896,2923,2950,2976,3003,
        3029,3056,3082,3108,3134,3161,3187,3213,3239,3264,3290,3316,3341,3367,3392,
        3418,3443,3468,3493,3518,3543,3567,3592,3616,3640,3665,3689,3713,3737,3760,
        3784,3808,3831,3854,3877,3900,3923,3946,3968,3990,4012,4034,4056,4076,4095,4095},
        /* level 2 */
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,3,4,6,7,9,11,13,15,18,21,23,26,28,
        31,34,37,40,43,47,51,54,58,63,67,72,77,82,87,93,99,105,111,118,124,131,139,146,
        153,161,169,177,186,194,203,212,221,230,239,249,259,269,279,289,300,310,321,
        332,343,354,365,377,388,400,412,424,436,448,460,472,485,497,510,523,536,549,
        562,575,589,602,616,630,644,658,672,687,702,717,731,747,762,777,793,809,825,
        842,859,876,893,911,929,947,966,985,1004,1024,1044,1064,1085,1106,1127,1148,
        1170,1191,1213,1234,1256,1277,1298,1319,1341,1362,1383,1404,1426,1447,1468,
        1489,1510,1531,1552,1572,1593,1614,1635,1656,1677,1698,1718,1739,1760,1780,
        1801,1821,1842,1863,1883,1904,1925,1946,1967,1988,2010,2032,2055,2077,2101,
        2124,2148,2173,2198,2224,2250,2276,2303,2330,2358,2386,2414,2442,2470,2497,
        2525,2552,2578,2605,2631,2656,2681,2706,2730,2754,2777,2800,2823,2845,2867,
        2889,2911,2932,2954,2975,2997,3018,3040,3061,3083,3105,3127,3149,3172,3195,
        3218,3241,3265,3289,3313,3338,3364,3390,3417,3445,3473,3502,3532,3562,3592,
        3624,3655,3687,3720,3753,3786,3818,3849,3878,3906,3932,3957,3982,4006,4029,
        4052,4075,4095,4095},
        /* 3: origin */
        {0,0,1,3,4,5,7,9,10,11,12,14,15,16,18,20,21,23,25,27,29,31,33,35,37,40,42,45,48,
        50,53,56,59,62,66,69,72,76,79,83,87,91,95,99,103,107,112,116,121,126,131,136,
        141,146,151,156,162,168,173,179,185,191,197,204,210,216,223,230,237,244,251,
        258,265,273,280,288,296,304,312,320,329,337,346,354,363,372,381,390,400,409,
        419,428,438,448,458,469,479,490,500,511,522,533,544,555,567,578,590,602,614,
        626,639,651,664,676,689,702,715,728,742,755,769,783,797,811,825,840,854,869,
        884,899,914,929,945,960,976,992,1008,1024,1041,1057,1074,1091,1108,1125,1142,
        1159,1177,1195,1213,1231,1249,1267,1286,1304,1323,1342,1361,1381,1400,1420,
        1440,1459,1480,1500,1520,1541,1562,1582,1603,1625,1646,1668,1689,1711,1733,
        1755,1778,1800,1823,1846,1869,1892,1916,1939,1963,1987,2011,2035,2059,2084,
        2109,2133,2159,2184,2209,2235,2260,2286,2312,2339,2365,2392,2419,2446,2473,
        2500,2527,2555,2583,2611,2639,2668,2696,2725,2754,2783,2812,2841,2871,2901,
        2931,2961,2991,3022,3052,3083,3114,3146,3177,3209,3240,3272,3304,3337,3369,
        3402,3435,3468,3501,3535,3568,3602,3636,3670,3705,3739,3774,3809,3844,3879,
        3915,3950,3986,4022,4059,4095,4095},
     };
}; // class VSDR2HDR

} // namespace android
#endif
